# spring_boot_msa_study
스프링 부트로 개발하는 MSA 컴포넌트 책 공부

---

### 2025-09-16

#### 모놀리식 아키텍처와 마이크로서비스 아키텍처 (MSA)

1. 모놀리식 아키텍처
 - 애플리케이션이 하나의 큰 프로젝트로 구성됨
 - 모든 기능 (회원, 주문, 결제, 게시판... 등)이 하나의 배포 단위에 포함됨
 - 하나의 DB를 여러 기능이 공유함 (주문, 결제, 예약 등.. 여러 기능이 같은 DB를 사용)
 - 초기 단순하고 빠르게 개발 가능
 - 규모가 커지고 기능이 복잡해지면 관리가 힘들고 유지보수에 자원이 많이 들어감
 - 트래픽이 많아지고 부하가 커지면 애플리케이션 전체를 스케일아웃 해야함 -> 확장성 문제
 - 작은 프로젝트 / 빠른 개발에 유리

2. 마이크로서비스 아키텍처
 - 애플리케이션을 여러 개의 독립된 서비스로 쪼갬
 - 각 서비스는 독립 배포 가능, 기능마다 각각의 DB를 가짐
 - 서비스간 통신은 주로 REST API, 메시지큐 (Kafka 등) 사용
 - 장애 격리 (한 서비스 장애가 전체 시스템에 영향을 덜 줌 -> 예약 관련 서비스가 터져도 호텔정보 또는 항공정보 등을 열람 가능)
 - 모놀리식 아키텍처보다 설계가 훨씬 복잡함
 - 서비스마다 DB가 따로있어서 분산 트랜잭션 이슈 발생 가능성 큼
 - 대규모 프로젝트에 적합

---

### 2025-09-17

#### MSA 설계

마이크로서비스 아키텍처를 설계할 때 정해진 법칙이나 왕도는 없음  
다만 원칙과 체계가 있으면 명확한 기준이 생기고, 마이크로서비스를 다시 나누거나 합치는 일이 좀 더 수월할 것

전체 서비스 관점에서 봤을 때 어느 정도 크기로 마이크로서비스를 분리해야 하는지,  
너무 작게 혹은 너무 크게 분리하는 것은 아닌지,  
등의 고민을 덜어줄 원칙들 정리

 - 서비스 세분화 원칙  
   - 비즈니스 기능  
     비즈니스 기능으로 서비스 나누기  
     하나의 서비스가 여러 비즈니스 동작을 제공하면 서비스 복잡도 높아짐 -> 유지보수 어려워짐  
   - 성능  
     서비스 크기가 너무 커서 성능에 영향이 갈 정도면 나누는 것을 고려
   - 메시지 크기  
     성능과 연관 있는데, 통신하는 데이터 크기가 너무 크다면 나누는 것을 고려
   - 트랜잭션  
     트랜잭션으로 서비스 나누기
     

 - 도메인 주도 설계 (DDD)  
   DDD는 내용이 방대하다 도메인 모델간의 확연한 경계인 "바운디드 컨텍스트"를 기억하자


 -  단일 책임 원칙  
    하나의 클래스는 하나의 책임 -> 응집도 높고 결합도 낮음 (독립영역 -> 바운디드 컨텍스트)  
    객체지향원칙이 마이크로서비스에도 적용됨


 - 가벼운 통신 프로토콜  
   각 마이크로서비스 간의 가벼운 통신 (HTTP 기반의 REST-API를 많이 사용)  
   각 서비스 간의 통신의 부하 최소화


 - 외부 공개 인터페이스  
   서비스간의 통신이 필연적이기 때문에 한번 공개된 마이크로서비스의 메시지 포맷(응답값 구조화)을 바꾸기 힘듬 -> 버전 변경 같은 방법으로 점진적으로 인터페이스를 변경함 

   
 - 마이크로서비스마다 독립된 데이터 저장소  
   단일 책임 원칙 응용 -> 각 서비스의 독립성 높임
   
마이크로서비스의 궁극적인 목적은 서비스 전체 기능을 빠르게 개발, 확장하기 위함  
각 서비스 의존성은 줄이고, 독립성을 보장해야 함

---

### 2025-09-18

#### 고가용성을 위한 확장

하나의 WAS, 하나의 DB로 시작한 서비스가 점점 사용자가 많아져 사용량이 늘어나면서 트래픽 부하로 시스템 장애가 생길 수 있다

WAS 확장  
서비스 안정성을 위하여 서버 이중화 혹은 다중화(확장, scale out)를 통해 고가용성을 확보하는 것이 중요하다
고가용성을 확보하는 방법은 여러가지가 있겠지만 일반적으로 로드 밸런서를 사용한다  
로드 밸런서가 사용자 요청을 모두 받고 서버로 사용자 요청을 분산한다 (이론상 로드 밸런서의 처리 한계까지 성능이 증가)  
또한 웹서버를 둬서 정적 리소스나 HTTPS 인증서 처리 등의 일들은 로드 밸런서가 웹서버로 보내 WAS의 부담을 덜어준다 

DB 확장  
DB는 WAS와 같이 스케일아웃 하기 힘들다  
하지만 DB도 고가용성을 확보할 수 있는 방법이 있는데, MySQL은 가장 많이 사용하는 방법이 MMM(Multi-Master Replication Manager for MySQL)이다  
간략하게 말하면 Master가 있고, Slave가 있는데 한개의 마스터로 여러개의 슬레이브를 만들고(복제) 마스터 DB의 데이터가 수정되면 해당 데이터들은 클러스터 내 여러 슬레이브로 전달되어 결국 모두 똑같은 데이터를 저장하게 된다  
여기서 마스터에서 슬레이브로 데이터를 전파하는 것을 리플리케이션(Replication)이라고 한다

또한 DB 샤딩 기법을 사용할 수 있는데,  
간단히 말해서 데이터들을 샤드라는 단위로 여러 데이터베이스 인스턴스에 나눠서 관리하는 기법이다  
100개의 데이터가 있으면, 5개의 샤드로 각 20개씩 나눠 관리하게 하며,  
WAS에 요청을 분산해줬던 로드 밸런서와 비슷하게 각 샤드의 위치를 알고, 관리하며 저장 및 조회를 돕는 일종의 애플리케이션인 로케이션 서비스가 있다  
샤딩 기법을 사용하면 확장성, 가용성이 좋아지며 성능이 향상 되지만, 운영 및 관리가 그만큼 복잡하기에 설계를 잘 하고 또 잘 알고 사용해야 한다

--- 
